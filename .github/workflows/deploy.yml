name: Deploy

on:
  push:
    branches:
      - main
    paths:
      - 'env/**/manifest.json'

jobs:
  deploy:
    runs-on: windows-latest
    strategy:
      matrix:
        env: [dev, test, preprod]

    env:
      target_host: ${{ fromJson('{"dev":"dev-host","test":"test-host","preprod":"preprod-host"}')[matrix.env] }}

    # This condition will run the job only if the commit message contains the matrix environment name
    if: contains(github.event.head_commit.message, matrix.env)

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Show IP config
        run: ipconfig

      - name: Deploy to target environment
        shell: pwsh
        env:
          TARGET_ENV: ${{ matrix.env }}
          TARGET_HOST: ${{ env.target_host }}
        run: |
          echo "Deploying to environment: $env:TARGET_ENV"
          echo "Target host is: $env:TARGET_HOST"
          # Yahan aap apne PowerShell deployment commands likh sakte hain
          # Example: Invoke-Command -ComputerName $env:TARGET_HOST -ScriptBlock { <deploy-script> }
